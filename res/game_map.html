<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="icon" type="image/png" href="icon.png"/>
	<link rel="icon" href="favicon.ico" type="image/x-icon"/>
	<link rel="shortcut icon" href="favicon.ico" type="image/x-icon"> 
	<link rel="Stylesheet" type="text/css" href="style.css" />
	<title>map</title>
	<script src="sha512.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script src="draw_map.js"></script>
	<script src="draw_radar.js"></script>

	<script type="text/javascript">
	
	var data_sync=0;
	var r;
	var xmlDoc;	
	function getXMLHttpRequest()
	{
	  var request = false;
	    
	  try {
	    request = new XMLHttpRequest();
	  } catch(err1) {
	    try {
	      request = new ActiveXObject('Msxml2.XMLHTTP');
	    } catch(err2) {
	      try {
		request = new ActiveXObject('Microsoft.XMLHTTP');                
	      } catch(err3) {
		request = false;
	      }
	    }
	  }
	  return request;
	}
	function processResponse()
	{
	  if (r.readyState == 4) {
	    if (r.status == 200) {

		var parser = new DOMParser();
		xmlDoc	=	parser.parseFromString(r.responseText				, "application/xml");
		xmlDoc2	=	parser.parseFromString(xmlDoc.getElementsByTagName('player')	, "application/xml");
	      alert(
		'XML z serwera: ' + 
		xmlDoc.firstChild.children[0].children//.text//.getElementsByTagName('tekst')[0].childNodes[0].nodeValue		
		//xmlDoc.getElementsByTagName('tekst')[0].childNodes[0].nodeValue
	      );
	    };
	  };
	}
	function ask_for_time() {
		
		xmlhttp=getXMLHttpRequest();
		xmlhttp.open("GET","ajax_time_request",false);
		xmlhttp.send();
		data_sync=xmlhttp.responseText;
		console.log(data_sync);
	}

	
	
	///////////////////////// timer
	
	
	var count
	var turn_time = 30;
	function countdown() {
		// your code goes here
		count = turn_time;
		UpdateTimer();
		var timerId = setInterval(function() {
			count--;
			console.log(count);
			UpdateTimer();
			if(count == 0) {
				// your code goes here
				count = turn_time+1;
			}
		}, 1000);
	}
	
	function UpdateTimer() {
		document.getElementById('game_clock').style.fontSize="large";
		document.getElementById('game_clock').innerHTML = "Turn ends in " + count + "s";
		
	}
	
	////////////////////////
	window.onload = function() {
		
		//ask_for_time();
		var here = new Date().getMilliseconds();
		if(data_sync!=0) {
			
			console.log(ask_for_time-(here/1000));
			
			// TODO : synchro handling USE data_sync;
			
		}
		countdown();
	
	}
	</script>
</head>

<body>

	<!--<a id="open">open</a> <br>
	<a id="output"></a><br>-->
	
	<div id="game_index_div" >
	
		<div id="game_index_header_div" class="game_header_div">
			
			<p id="game_index_header_logo_p" class="game_header_logo_p">SPACE ZOMBIE</p>
			<p id="game_clock">TIME</p>
		
		
		</div>
		<div id="game_index_list_div" class="game_list_div">
			<button class="game_list_button" onclick = "getNewDate()">Overview</button>
			<button id="game_list_button_map" onclick = "location.href='game_map.html'" class="game_list_button">Map</button>
			<button class="game_list_button">Ships</button>
			<button class="game_list_button">Science</button>
			<button class="game_list_button">Alliance</button>
		
		
		
		</div>
		<div id="game_index_content_div" class="game_content_div">
		
			<div id="game_map_content_title_div" class="game_content_title_div">
			</div>
			
			<div id="world_map_div" width=600px height=600px>
				<p id="world_map_p">Select sector</p>
				<canvas id="world_map_canvas" width=500px height=500px>
				Your browser does not support the HTML5 canvas tag.
				</canvas>
				
			</div>
			
			<div id="radar_div" width=600px height=600px>
				<p id="radar_p">Select target</p>
				<canvas id="radar_canvas" width=500px height=500px>
				Your browser does not support the HTML5 canvas tag.
				</canvas>
				
			</div>
			<br>
			<div id="world_map_sector_div" width=600px height=70px>
				<p id="world_map_sector_p">Selected sector:</p>
			</div>
		
		
		</div>
	
	
	
	</div>
	
</body>
</html>
